<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±ä¸€AIé …ç›® - äº¤äº’ç•Œé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            color: white;
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        main {
            flex: 1;
            display: flex;
            max-width: 1200px;
            margin: 2rem auto;
            gap: 2rem;
            padding: 0 2rem;
            width: 100%;
        }
        
        .chat-section {
            flex: 1;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            height: 400px;
        }
        
        .message {
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.8rem;
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.2rem;
        }
        
        .message.user .message-avatar {
            background: linear-gradient(135deg, #FF6B6B, #FF8787);
        }
        
        .message.assistant .message-avatar {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
        }
        
        .message-content {
            max-width: 70%;
            padding: 0.8rem 1.2rem;
            border-radius: 15px;
            background: #f1f1f1;
            position: relative;
        }
        
        .message.user .message-content {
            background: #007AFF;
            color: white;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: #666;
            margin-top: 0.3rem;
        }
        
        .chat-input {
            padding: 1rem;
            border-top: 1px solid #eee;
            display: flex;
            gap: 1rem;
        }
        
        .chat-input input {
            flex: 1;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .chat-input input:focus {
            border-color: #667eea;
        }
        
        .chat-input button {
            padding: 0.8rem 1.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .chat-input button:hover {
            transform: translateY(-2px);
        }
        
        .chat-input button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .pet-section {
            width: 350px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }
        
        .pet-header {
            background: linear-gradient(135deg, #FFA726, #FB8C00);
            color: white;
            padding: 1rem;
            text-align: center;
        }
        
        .pet-avatar {
            padding: 2rem;
            text-align: center;
            background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
        }
        
        .pet-image {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            border-radius: 50%;
            background: linear-gradient(135deg, #81C784, #66BB6A);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pet-status {
            padding: 1.5rem;
            border-top: 1px solid #eee;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .status-label {
            font-weight: 600;
            color: #333;
        }
        
        .status-value {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-bar {
            width: 80px;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .status-fill {
            height: 100%;
            background: linear-gradient(135deg, #4CAF50, #81C784);
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .pet-actions {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .action-btn {
            flex: 1;
            padding: 0.6rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: transform 0.2s;
            min-width: 80px;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
        }
        
        .system-info {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 1.5rem;
            margin-top: 2rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .info-item {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .info-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .info-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            main {
                flex-direction: column;
            }
            
            .pet-section {
                width: 100%;
            }
            
            .message-content {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ğŸ¤– çµ±ä¸€AIé …ç›®</h1>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>ç³»çµ±é‹è¡Œä¸­</span>
            </div>
        </div>
    </header>

    <main>
        <section class="chat-section">
            <div class="chat-header">
                <h2>ğŸ’¬ æ™ºèƒ½å°è©±</h2>
                <span id="response-time">éŸ¿æ‡‰æ™‚é–“: --</span>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message assistant">
                    <div class="message-avatar">ğŸ¤–</div>
                    <div class="message-content">
                        <div>ä½ å¥½ï¼æˆ‘æ˜¯çµ±ä¸€AIç³»çµ±çš„åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¹«åŠ©ä½ é€²è¡Œå°è©±ã€ç®¡ç†è¨˜æ†¶ã€å•Ÿå‹•ä»£ç†ï¼Œä»¥åŠèˆ‡æ¡Œé¢å¯µç‰©äº’å‹•ã€‚æœ‰ä»€éº¼å¯ä»¥å¹«åŠ©ä½ çš„å—ï¼Ÿ</div>
                        <div class="message-time">ç¾åœ¨</div>
                    </div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="message-input" placeholder="è¼¸å…¥ä½ çš„è¨Šæ¯..." onkeypress="handleKeyPress(event)">
                <button id="send-btn" onclick="sendMessage()">ç™¼é€</button>
            </div>
        </section>

        <aside class="pet-section">
            <div class="pet-header">
                <h3>ğŸ¾ æ¡Œé¢å¯µç‰© - Angela</h3>
            </div>
            <div class="pet-avatar">
                <div class="pet-image">ğŸ±</div>
            </div>
            <div class="pet-status">
                <div class="status-item">
                    <span class="status-label">é£¢é¤“åº¦</span>
                    <div class="status-value">
                        <div class="status-bar">
                            <div class="status-fill" id="hunger-bar" style="width: 60%"></div>
                        </div>
                        <span id="hunger-value">60%</span>
                    </div>
                </div>
                <div class="status-item">
                    <span class="status-label">å¿«æ¨‚åº¦</span>
                    <div class="status-value">
                        <div class="status-bar">
                            <div class="status-fill" id="happiness-bar" style="width: 80%"></div>
                        </div>
                        <span id="happiness-value">80%</span>
                    </div>
                </div>
                <div class="status-item">
                    <span class="status-label">ç²¾åŠ›å€¼</span>
                    <div class="status-value">
                        <div class="status-bar">
                            <div class="status-fill" id="energy-bar" style="width: 70%"></div>
                        </div>
                        <span id="energy-value">70%</span>
                    </div>
                </div>
            </div>
            <div class="pet-actions">
                <button class="action-btn" onclick="feedPet()">ğŸ– å–‚é£Ÿ</button>
                <button class="action-btn" onclick="playWithPet()">ğŸ¾ ç©è€</button>
                <button class="action-btn" onclick="petPet()">ğŸ‘† æ’«æ‘¸</button>
                <button class="action-btn" onclick="cleanPet()">ğŸ§¼ æ¸…æ½”</button>
            </div>
        </aside>
    </main>

    <section class="system-info">
        <h3>ğŸ“Š ç³»çµ±ç‹€æ…‹</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-value" id="active-agents">2</div>
                <div class="info-label">æ´»èºä»£ç†</div>
            </div>
            <div class="info-item">
                <div class="info-value" id="memory-count">3</div>
                <div class="info-label">è¨˜æ†¶æ•¸é‡</div>
            </div>
            <div class="info-item">
                <div class="info-value" id="processing-time">10s</div>
                <div class="info-label">è™•ç†æ™‚é–“</div>
            </div>
            <div class="info-item">
                <div class="info-value" id="success-rate">100%</div>
                <div class="info-label">æˆåŠŸç‡</div>
            </div>
        </div>
    </section>

    <script>
        // APIåŸºç¤URL
        const API_BASE = 'http://localhost:8000/api/v1';
        
        // ç‹€æ…‹æ•¸æ“š
        let petStatus = {
            hunger: 60,
            happiness: 80,
            energy: 70
        };
        
        let systemStats = {
            activeAgents: 2,
            memoryCount: 3,
            processingTime: '10s',
            successRate: '100%'
        };

        // ç™¼é€æ¶ˆæ¯
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // ç¦ç”¨è¼¸å…¥å’ŒæŒ‰éˆ•
            input.disabled = true;
            document.getElementById('send-btn').disabled = true;
            
            // æ·»åŠ ç”¨æˆ¶æ¶ˆæ¯åˆ°ç•Œé¢
            addMessage(message, 'user');
            
            try {
                const startTime = Date.now();
                
                // ç™¼é€åˆ°å¾Œç«¯API
                const response = await fetch(`${API_BASE}/chat/mscu`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        user_id: 'web_user_' + Date.now()
                    })
                });
                
                const data = await response.json();
                const endTime = Date.now();
                
                // é¡¯ç¤ºéŸ¿æ‡‰æ™‚é–“
                const responseTime = ((endTime - startTime) / 1000).toFixed(1);
                document.getElementById('response-time').textContent = `éŸ¿æ‡‰æ™‚é–“: ${responseTime}s`;
                
                // æ·»åŠ AIå›æ‡‰åˆ°ç•Œé¢
                if (response.ok) {
                    addMessage(data.response || 'æŠ±æ­‰ï¼Œæˆ‘ç„¡æ³•è™•ç†é€™å€‹è«‹æ±‚ã€‚', 'assistant');
                } else {
                    addMessage('æŠ±æ­‰ï¼Œç™¼ç”Ÿäº†éŒ¯èª¤ã€‚è«‹ç¨å¾Œå†è©¦ã€‚', 'assistant');
                }
                
            } catch (error) {
                console.error('Error:', error);
                addMessage('ç¶²è·¯éŒ¯èª¤ï¼šç„¡æ³•é€£æ¥åˆ°AIæœå‹™å™¨ã€‚', 'assistant');
            } finally {
                // é‡æ–°å•Ÿç”¨è¼¸å…¥å’ŒæŒ‰éˆ•
                input.disabled = false;
                document.getElementById('send-btn').disabled = false;
                input.value = '';
                input.focus();
            }
        }
        
        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢
        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = sender === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';
            const time = new Date().toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div>${content}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // è™•ç†Enteréµ
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        // å¯µç‰©äº¤äº’å‡½æ•¸
        async function feedPet() {
            await petAction('feed', 'ğŸ– ä½ çµ¦å¯µç‰©å–‚é£Ÿäº†ï¼');
        }
        
        async function playWithPet() {
            await petAction('play', 'ğŸ¾ ä½ å’Œå¯µç‰©ç©è€äº†ï¼');
        }
        
        async function petPet() {
            await petAction('pet', 'ğŸ‘† ä½ æ’«æ‘¸äº†å¯µç‰©ï¼');
        }
        
        async function cleanPet() {
            await petAction('clean', 'ğŸ§¼ ä½ å¹«å¯µç‰©æ¸…æ½”äº†ï¼');
        }
        
        async function petAction(action, message) {
            try {
                // æ¨¡æ“¬APIèª¿ç”¨
                console.log('Pet action:', action);
                
                // æ›´æ–°å¯µç‰©ç‹€æ…‹
                updatePetStatus(action);
                
                // é¡¯ç¤ºåé¥‹
                addMessage(message, 'assistant');
                
            } catch (error) {
                console.error('Pet action error:', error);
            }
        }
        
        // æ›´æ–°å¯µç‰©ç‹€æ…‹
        function updatePetStatus(action) {
            switch(action) {
                case 'feed':
                    petStatus.hunger = Math.max(0, petStatus.hunger - 20);
                    petStatus.happiness = Math.min(100, petStatus.happiness + 10);
                    break;
                case 'play':
                    petStatus.energy = Math.max(0, petStatus.energy - 15);
                    petStatus.happiness = Math.min(100, petStatus.happiness + 20);
                    break;
                case 'pet':
                    petStatus.happiness = Math.min(100, petStatus.happiness + 5);
                    break;
                case 'clean':
                    petStatus.happiness = Math.min(100, petStatus.happiness + 10);
                    break;
            }
            
            // æ›´æ–°ç•Œé¢
            updatePetUI();
        }
        
        // æ›´æ–°å¯µç‰©ç•Œé¢
        function updatePetUI() {
            document.getElementById('hunger-bar').style.width = petStatus.hunger + '%';
            document.getElementById('hunger-value').textContent = petStatus.hunger + '%';
            
            document.getElementById('happiness-bar').style.width = petStatus.happiness + '%';
            document.getElementById('happiness-value').textContent = petStatus.happiness + '%';
            
            document.getElementById('energy-bar').style.width = petStatus.energy + '%';
            document.getElementById('energy-value').textContent = petStatus.energy + '%';
        }
        
        // ç²å–ç³»çµ±ç‹€æ…‹
        async function fetchSystemStatus() {
            try {
                const response = await fetch(`${API_BASE}/system/status`);
                if (response.ok) {
                    const data = await response.json();
                    updateSystemStats(data);
                }
            } catch (error) {
                console.error('Failed to fetch system status:', error);
            }
        }
        
        // æ›´æ–°ç³»çµ±çµ±è¨ˆ
        function updateSystemStats(data) {
            document.getElementById('active-agents').textContent = data.metrics?.active_agents || systemStats.activeAgents;
            document.getElementById('memory-count').textContent = data.services?.ham_memory_manager?.memory_count || systemStats.memoryCount;
            
            // æ›´æ–°å…¶ä»–çµ±è¨ˆ
            systemStats.activeAgents = data.metrics?.active_agents || systemStats.activeAgents;
            systemStats.memoryCount = data.services?.ham_memory_manager?.memory_count || systemStats.memoryCount;
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // èšç„¦è¼¸å…¥æ¡†
            document.getElementById('message-input').focus();
            
            // å®šæœŸæ›´æ–°ç³»çµ±ç‹€æ…‹
            fetchSystemStatus();
            setInterval(fetchSystemStatus, 30000); // æ¯30ç§’æ›´æ–°ä¸€æ¬¡
            
            // æ¨¡æ“¬å¯µç‰©ç‹€æ…‹éš¨æ™‚é–“è®ŠåŒ–
            setInterval(() => {
                petStatus.hunger = Math.min(100, petStatus.hunger + 1);
                petStatus.happiness = Math.max(0, petStatus.happiness - 0.5);
                petStatus.energy = Math.max(0, petStatus.energy - 0.3);
                updatePetUI();
            }, 5000); // æ¯5ç§’æ›´æ–°ä¸€æ¬¡
        });
    </script>
</body>
</html>