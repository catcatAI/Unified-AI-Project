# ⚡ 强制复杂度检查规定

## 🚨 项目复杂度评估结果

**检查时间**: 2025年10月6日 17:04
**评估结果**: **COMPLEX（复杂级别）**

### 📊 关键指标
- **Python文件总数**: 30,819个
- **抽样分析**: 103个文件
- **总行数**: 21,419行（抽样）
- **语法错误**: 75个（抽样）
- **最大文件**: 790行

## 🚫 严格禁令

基于复杂度评估结果，以下行为**严格禁止**:

### 绝对禁止的修复方法
1. **❌ 根目录简单修复脚本** - 任何直接创建的`.py`修复脚本
2. **❌ 正则表达式批量替换** - 无AST分析的简单替换
3. **❌ 无范围限制的修复** - 影响整个项目的批量操作
4. **❌ 无验证的批量修复** - 修复后不进行验证
5. **❌ 一次性全项目修复** - 试图一次性解决所有问题

### 必须使用的方法
1. **✅ 统一自动修复系统** - `python -m unified_auto_fix_system.main`
2. **✅ 分批处理模式** - 按目录、按优先级分批处理
3. **✅ 干运行验证** - 先验证再实际执行
4. **✅ 单目录/单文件处理** - 严格限制影响范围
5. **✅ 即时验证机制** - 每批修复后立即验证效果

## 🎯 基于复杂度的执行策略

### COMPLEX级别的特殊要求

#### 1. 修复前强制检查
```bash
# 每次修复前必须运行复杂度检查
python quick_complexity_check.py

# 如果返回错误码，禁止继续
if [ $? -eq 1 ]; then
    echo "项目复杂度过高，必须使用分批模式"
    exit 1
fi
```

#### 2. 分批处理策略
```bash
# ✅ 正确的分批处理方式
# 第一批：核心应用（优先级最高）
python -m unified_auto_fix_system.main fix --target apps/backend --types syntax_fix --priority critical

# 验证第一批效果
python quick_verify.py

# 第二批：工具脚本
python -m unified_auto_fix_system.main fix --target tools --types syntax_fix --priority high

# 第三批：测试文件（优先级较低）
python -m unified_auto_fix_system.main fix --target tests --types syntax_fix --priority normal
```

#### 3. 每批限制数量
- **每批最大文件数**: 50个
- **每批最大错误数**: 25个
- **每批处理时间**: 不超过5分钟

## 📋 执行检查清单

### 修复前必须确认
- [ ] 运行复杂度检查并获得通过
- [ ] 确认修复目标范围（单目录/单文件）
- [ ] 设置合适的优先级（critical/high/normal/low）
- [ ] 准备验证机制

### 修复中必须监控
- [ ] 监控处理时间（不超过5分钟）
- [ ] 监控错误数量（不超过25个）
- [ ] 监控影响范围（不超出目标范围）
- [ ] 干运行模式先验证

### 修复后必须验证
- [ ] 运行快速验证脚本
- [ ] 检查相关功能是否正常
- [ ] 确认语法错误数量减少
- [ ] 更新修复进度记录

## ⚠️ 违规后果

### 技术后果
- 违规修复将被自动回滚
- 必须进行额外的稳定性检查
- 相关开发者将被记录违规次数

### 项目后果
- 延缓整体修复进度
- 增加额外的验证和清理工作
- 影响项目质量评估的准确性

## 🎯 成功案例标准

### 成功的修复应该
1. **数量真实**: 基于实际统计，而非夸大数字
2. **范围明确**: 只影响目标文件，不波及其他
3. **效果可验证**: 修复后立即可以验证效果
4. **过程可回溯**: 有完整的修复记录和日志
5. **质量有保障**: 不引入新的问题

## 📊 复杂度分级标准

### Simple级别（绿色）
- Python文件 < 100个
- 总行数 < 10,000行
- 语法错误 < 10个
- **允许**: 统一修复系统全项目处理

### Medium级别（黄色）
- Python文件 100-500个
- 总行数 10,000-50,000行
- 语法错误 10-100个
- **要求**: 统一修复系统分批处理

### Complex级别（橙色）⚠️ **当前级别**
- Python文件 > 500个
- 总行数 > 50,000行
- 语法错误 > 100个
- **要求**: 严格分批，单目录处理，干运行验证

### Mega级别（红色）
- Python文件 > 2000个
- 总行数 > 200,000行
- 语法错误 > 500个
- **要求**: 人工设计修复方案，禁止自动化

## 🏆 成功案例参考

基于真实数据的修复目标：
- **当前语法错误**: ~200+个（而非虚假的22,046个）
- **核心错误**: ~50个（优先处理）
- **预计修复时间**: 2-3周（分批处理）
- **成功标准**: 语法错误率<1%

---

**💡 核心原则**: **宁要慢而稳，不要快而乱**

**🎯 最终目标**: 建立可持续、可验证、可回溯的自动化修复流程