<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angela AI Web Live2D Viewer</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #333; /* Dark background for visibility */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #live2d-container {
            position: relative;
            width: 1280px; /* Base width for 720p */
            height: 720px; /* Base height for 720p */
            background-color: transparent;
            overflow: hidden;
            border: 1px solid #555; /* Border to show container boundaries */
        }
        #live2d-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Live2D canvas should not block pointer events */
        }
        #fallback-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none; /* Hidden by default */
            pointer-events: none;
        }
        #fallback-canvas {
            width: 100%;
            height: 100%;
        }
        #click-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100; /* Above canvas to capture clicks */
            pointer-events: auto; /* This layer should capture pointer events */
        }
        #dialogue-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 150px;
            background: rgba(0,0,0,0.7);
            color: white;
            display: flex;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            z-index: 200;
        }
        #dialogue-messages {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 10px;
            border: 1px solid #555;
            padding: 5px;
        }
        #dialogue-input-container {
            display: flex;
            gap: 10px;
        }
        #dialogue-input {
            flex-grow: 1;
            padding: 5px;
            background: #444;
            border: 1px solid #666;
            color: white;
        }
        #btn-send {
            padding: 5px 10px;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="live2d-container">
        <canvas id="live2d-canvas"></canvas>
        <div id="fallback-wrapper">
            <canvas id="fallback-canvas"></canvas>
        </div>
        <div id="click-layer"></div>
    </div>

    <div id="dialogue-overlay">
        <div id="dialogue-messages"></div>
        <div id="dialogue-input-container">
            <input type="text" id="dialogue-input" placeholder="Type your message...">
            <button id="btn-send">Send</button>
        </div>
    </div>

    <!-- Live2D Cubism Web SDK -->
    <script src="libs/live2dcubismcore.min.js"></script>
    <script src="libs/live2dframework/dist/live2dcubismframework.bundle.js"></script>
    <script src="libs/live2dframework/live2dcubism-init.js"></script>
    <script src="libs/live2d-fallback.js"></script>

    <!-- Angela AI Core Scripts -->
    <script src="js/logger.js"></script>
    <script src="js/data-persistence.js"></script>
    <script src="js/frontend-utils.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/theme-manager.js"></script>
    <script src="js/security-utils.js"></script>

    <script src="js/state-matrix.js"></script>
    <script src="js/performance-manager.js"></script>
    <script src="js/maturity-tracker.js"></script>
    <script src="js/precision-manager.js"></script>

    <script src="js/live2d-cubism-wrapper.js"></script>

    <!-- Character Configuration - UDM and Live2DManager depend on these -->
    <script src="js/angela-character-config.js"></script>
    <script src="js/angela-character-images-config.js"></script>

    <!-- Unified Display Matrix (UDM) - Core dependency -->
    <script src="js/unified-display-matrix.js"></script>

    <!-- Character System & Input -->
    <script src="js/layer-renderer.js"></script>
    <script src="js/live2d-manager.js"></script>
    <script src="js/input-handler.js"></script>
    <script src="js/character-touch-detector.js"></script>

    <!-- Backend & API Clients -->
    <script src="js/backend-websocket.js"></script>
    <script src="js/api-client.js"></script>
    <!-- Placeholder for Dialogue UI if it's a separate file -->
    <!-- <script src="js/dialogue-ui.js"></script> -->

    <!-- Main App Initialization -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('[WebViewer] Starting Angela App initialization...');
            // Mock Electron API for web environment
            window.electronAPI = {
                settings: {
                    open: () => console.log('Settings opened (web mock)')
                },
                window: {
                    minimize: () => console.log('Window minimized (web mock)'),
                    maximize: () => console.log('Window maximized (web mock)'),
                    close: () => console.log('Window closed (web mock)'),
                    setBounds: (bounds) => console.log('Window setBounds (web mock):', bounds),
                    setAlwaysOnTop: (flag) => console.log('Window setAlwaysOnTop (web mock):', flag),
                    setIgnoreMouseEvents: (ignore, options) => console.log('Window setIgnoreMouseEvents (web mock):', ignore, options)
                },
                security: {
                    init: async (keyC) => {
                        console.log('Security (web mock) initialized with key:', keyC);
                        return { success: true };
                    }
                },
                on: (channel, callback) => {
                    console.log(`ElectronAPI.on called for channel: ${channel} (web mock)`);
                    // Implement a basic event system if needed, or just log
                }
            };
            window.angelaApp = new AngelaApp();
            await window.angelaApp.initialize();
        });
    </script>
</body>
</html>

