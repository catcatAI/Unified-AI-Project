<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æª¢æ¸¬ç³»çµ±æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a2e; color: #eee; }
        .test-section { margin: 20px 0; padding: 15px; background: #16213e; border-radius: 8px; }
        .pass { color: #4ade80; }
        .fail { color: #f87171; }
        .info { color: #60a5fa; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; font-size: 14px; }
        .btn-test { background: #3b82f6; color: white; }
        .btn-test:hover { background: #2563eb; }
        pre { background: #0f0f23; padding: 15px; border-radius: 5px; overflow: auto; max-height: 300px; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Angela AI æª¢æ¸¬ç³»çµ±æ¸¬è©¦</h1>
    
    <div class="test-section">
        <h2>æ­¥é©Ÿ 1: è¼‰å…¥æª¢æ¸¬æ¨¡å¡Š</h2>
        <div id="step1"></div>
    </div>
    
    <div class="test-section">
        <h2>æ­¥é©Ÿ 2: æ¸¬è©¦ DriverDetector</h2>
        <button class="btn-test" onclick="testDriverDetector()">æ¸¬è©¦é©…å‹•æª¢æ¸¬</button>
        <div id="driver-result"></div>
    </div>
    
    <div class="test-section">
        <h2>æ­¥é©Ÿ 3: æ¸¬è©¦ AvailabilityManager</h2>
        <button class="btn-test" onclick="testAvailabilityManager()">æ¸¬è©¦å¯ç”¨æ€§ç®¡ç†</button>
        <div id="availability-result"></div>
    </div>
    
    <div class="test-section">
        <h2>æ­¥é©Ÿ 4: æ¸¬è©¦ UnifiedDetectionSystem</h2>
        <button class="btn-test" onclick="testUnifiedDetection()">æ¸¬è©¦çµ±ä¸€æª¢æ¸¬</button>
        <div id="unified-result"></div>
    </div>
    
    <div class="test-section">
        <h2>å®Œæ•´ç‹€æ…‹å ±å‘Š</h2>
        <button class="btn-test" onclick="getFullStatus()">ç²å–å®Œæ•´ç‹€æ…‹</button>
        <pre id="full-status"></pre>
    </div>

    <!-- è¼‰å…¥æª¢æ¸¬æ¨¡å¡Š -->
    <script src="js/driver-detector.js"></script>
    <script src="js/availability-manager.js"></script>
    <script src="js/unified-detection.js"></script>
    
    <script>
        // æ­¥é©Ÿ 1: æª¢æŸ¥æ¨¡å¡Šè¼‰å…¥
        document.getElementById('step1').innerHTML = 
            (typeof DriverDetector !== 'undefined' ? '<span class="pass">âœ“</span> DriverDetector å·²è¼‰å…¥' : '<span class="fail">âœ—</span> DriverDetector æœªè¼‰å…¥') + '<br>' +
            (typeof AvailabilityManager !== 'undefined' ? '<span class="pass">âœ“</span> AvailabilityManager å·²è¼‰å…¥' : '<span class="fail">âœ—</span> AvailabilityManager æœªè¼‰å…¥') + '<br>' +
            (typeof UnifiedDetectionSystem !== 'undefined' ? '<span class="pass">âœ“</span> UnifiedDetectionSystem å·²è¼‰å…¥' : '<span class="fail">âœ—</span> UnifiedDetectionSystem æœªè¼‰å…¥');

        async function testDriverDetector() {
            const div = document.getElementById('driver-result');
            div.innerHTML = '<span class="info">æ­£åœ¨æ¸¬è©¦...</span>';
            try {
                const detector = new DriverDetector();
                await detector.initialize();
                const status = detector.getDriverStatus();
                div.innerHTML = `<span class="pass">âœ“</span> é©…å‹•æª¢æ¸¬æˆåŠŸ<br>` +
                    `GPU: ${status.gpu.status}<br>` +
                    `Audio: ${status.audio.status}<br>` +
                    `Input: ${status.input.status}<br>` +
                    `Network: ${status.network.status}`;
            } catch (e) {
                div.innerHTML = `<span class="fail">âœ—</span> éŒ¯èª¤: ${e.message}`;
            }
        }

        async function testAvailabilityManager() {
            const div = document.getElementById('availability-result');
            div.innerHTML = '<span class="info">æ­£åœ¨æ¸¬è©¦...</span>';
            try {
                const manager = new AvailabilityManager({ enableAutoRecovery: true });
                await manager.initialize();
                const status = manager.getQuickStatus();
                div.innerHTML = `<span class="pass">âœ“</span> å¯ç”¨æ€§ç®¡ç†æ¸¬è©¦æˆåŠŸ<br>` +
                    `ç‹€æ…‹: ${status.state}<br>` +
                    `å¥åº·åˆ†æ•¸: ${status.score}<br>` +
                    `å­ç³»çµ±: ${Object.keys(manager.subsystems).join(', ')}`;
            } catch (e) {
                div.innerHTML = `<span class="fail">âœ—</span> éŒ¯èª¤: ${e.message}`;
            }
        }

        async function testUnifiedDetection() {
            const div = document.getElementById('unified-result');
            div.innerHTML = '<span class="info">æ­£åœ¨æ¸¬è©¦...</span>';
            try {
                const system = new UnifiedDetectionSystem({ checkInterval: 10000 });
                await system.initialize();
                div.innerHTML = `<span class="pass">âœ“</span> çµ±ä¸€æª¢æ¸¬ç³»çµ±åˆå§‹åŒ–æˆåŠŸ<br>` +
                    `æª¢æŸ¥é–“éš”: ${system.checkInterval}ms<br>` +
                    `å¯ç”¨æ–¹æ³•: getFullStatus(), runDiagnostics(), generateReport()`;
            } catch (e) {
                div.innerHTML = `<span class="fail">âœ—</span> éŒ¯èª¤: ${e.message}`;
            }
        }

        async function getFullStatus() {
            const pre = document.getElementById('full-status');
            pre.innerHTML = '<span class="info">æ­£åœ¨ç²å–ç‹€æ…‹...</span>';
            try {
                const system = new UnifiedDetectionSystem();
                await system.initialize();
                const status = system.getFullStatus();
                pre.textContent = JSON.stringify(status, null, 2);
            } catch (e) {
                pre.textContent = `éŒ¯èª¤: ${e.message}\n${e.stack}`;
            }
        }
    </script>
</body>
</html>