{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "HSPTaskResultPayload_v0.1",
  "description": "Schema for HSP Task Result Payload version 0.1. Represents the outcome of a previously submitted HSPTaskRequest.",
  "type": "object",
  "properties": {
    "result_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique ID for this task result, generated by the executing AI. (Required)"
    },
    "request_id": {
      "type": "string",
      "format": "uuid",
      "description": "ID of the corresponding TaskRequest this result is for. (Required)"
    },
    "executing_ai_id": {
      "type": "string",
      "description": "DID or URI of the AI that executed the task and is sending this result. (Required)"
    },
    "status": {
      "type": "string",
      "enum": ["success", "failure", "in_progress", "queued", "rejected", "timeout"],
      "description": "The final or intermediate status of the task execution. (Required)"
    },
    "payload": {
      "type": "object",
      "description": "The actual result data if status is 'success'. Its structure should conform to the capability's advertised output schema."
    },
    "output_data_format": {
      "type": "string",
      "description": "Optional confirmation of the data format of the 'payload' (e.g., 'application/json', 'text/plain', 'image/png')."
    },
    "error_details": {
      "type": "object",
      "description": "Details of the error if status is 'failure', 'rejected', or 'timeout'.",
      "properties": {
        "error_code": {
          "type": "string",
          "description": "A machine-readable error code (e.g., 'CAPABILITY_NOT_FOUND', 'INVALID_PARAMETERS', 'EXECUTION_TIMEOUT', 'INTERNAL_ERROR'). (Required)"
        },
        "error_message": {
          "type": "string",
          "description": "A human-readable description of the error. (Required)"
        },
        "error_context": {
          "type": "object",
          "description": "Optional additional context or details about the error (e.g., stack trace snippet, specific parameter that failed validation).",
          "additionalProperties": true
        }
      },
      "required": ["error_code", "error_message"],
      "additionalProperties": false
    },
    "timestamp_generated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 UTC timestamp of when this result was generated by the executing_ai_id. (Required)"
    },
    "execution_metadata": {
      "type": "object",
      "description": "Optional additional metadata about the task execution (e.g., {'time_taken_ms': 150, 'resources_consumed': '2_units', 'intermediate_steps_count': 5}).",
      "additionalProperties": true
    },
    "progress_percentage": {
        "type": "integer",
        "minimum": 0,
        "maximum": 100,
        "description": "Optional field to indicate task progress, especially if status is 'in_progress'."
    }
  },
  "required": [
    "result_id",
    "request_id",
    "executing_ai_id",
    "status",
    "timestamp_generated"
  ],
  "if": {
    "properties": {"status": {"const": "success"}}
  },
  "then": {
    "required": ["payload"]
  },
  "else": {
    "if": {
        "properties": {"status": {"enum": ["failure", "rejected", "timeout"]}}
    },
    "then": {
        "required": ["error_details"]
    }
  },
  "additionalProperties": false
}
