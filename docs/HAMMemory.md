# 記憶管理系統 (HAM) 文檔

## 現況

HAM (Hierarchical Associative Memory) 分層關聯記憶系統是 Unified AI Project 的核心記憶架構，目前已完成實現並處於穩定狀態。它提供了高效的記憶存儲、檢索和抽象能力，是系統智能的基礎。

### 實現狀態

- **完成度**: 100%
- **版本**: 1.0.0
- **位置**: `apps/backend/src/ai/memory/ham_memory_manager.py`
- **行數**: 約1145行代碼

### 核心功能

- **記憶存儲**: 支持多種數據類型的存儲和持久化
- **記憶檢索**: 基於關鍵詞、語義和元數據的多維檢索
- **記憶抽象**: 自動提取和壓縮記憶的關鍵信息
- **記憶管理**: 記憶重要性評估和遺忘機制
- **向量存儲**: 基於ChromaDB的語義向量檢索

### 已實現的特性

- **HAMMemoryManager**: 完整的記憶管理器實現
- **記憶存儲與檢索**: 支持存儲和檢索各類經驗數據
- **記憶抽象與壓縮**: 自動提取記憶摘要和關鍵信息
- **資源感知**: 模擬資源限制下的記憶管理
- **與其他系統集成**: 與LIS系統和學習系統的集成

## 設計

### 架構設計

HAM記憶系統採用分層設計，將記憶存儲、處理和檢索分離，確保系統的可靠性和可擴展性。

#### 關鍵組件

1. **HAMMemoryManager**
   - 核心API: 提供記憶存儲和檢索的主要接口
   - 記憶處理: 抽象、壓縮和加密記憶數據
   - 持久化: 將記憶保存到文件系統
   - 資源管理: 模擬和管理系統資源限制

2. **記憶數據結構**
   - HAMDataPackageInternal: 內部記憶數據包格式
   - DialogueMemoryEntryMetadata: 對話記憶元數據
   - HAMRecallResult: 記憶檢索結果格式

3. **向量存儲集成**
   - ChromaDB集成: 用於語義向量存儲和檢索
   - 向量嵌入: 將文本轉換為語義向量
   - 相似度搜索: 基於向量相似度的記憶檢索

### 記憶處理流程

#### 存儲流程

```python
async def store_experience(self, raw_data: Any, data_type: str, metadata: Optional[DialogueMemoryEntryMetadata] = None) -> Optional[str]:
    # 1. 檢查資源限制
    # 2. 處理元數據
    # 3. 抽象和壓縮數據
    # 4. 加密數據包
    # 5. 生成記憶ID並存儲
    # 6. 保存到持久化存儲
    # 7. 返回記憶ID
```

#### 檢索流程

```python
async def recall_experiences(self, query: str, limit: int = 5) -> List[HAMRecallResult]:
    # 1. 執行語義搜索 (如果啟用)
    # 2. 執行關鍵詞搜索
    # 3. 合併結果並排序
    # 4. 反序列化記憶
    # 5. 返回結果
```

### 記憶抽象機制

HAM系統使用多層次抽象機制處理記憶：

1. **初級抽象**: 提取原始數據的關鍵信息
2. **二級抽象**: 壓縮和結構化關鍵信息
3. **高級抽象**: 生成記憶的概念表示

這種分層抽象使系統能夠高效存儲大量記憶，同時保留關鍵信息。

## 未來計劃

1. **性能優化**
   - 實現更高效的記憶索引
   - 優化向量存儲和檢索
   - 改進記憶壓縮算法

2. **功能增強**
   - 實現更複雜的記憶關聯網絡
   - 添加情境感知記憶檢索
   - 實現長期知識保持機制

3. **集成增強**
   - 與學習系統深度集成
   - 支持跨實例記憶共享
   - 實現記憶創新與重組能力