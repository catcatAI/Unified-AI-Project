# 完整数据集训练指南

## 概述

本文档介绍了如何使用Unified-AI-Project进行完整数据集（十几GB）的训练，包括暂停、继续、意外中断恢复等功能。

**注意**：[full_dataset_training](../training/configs/training_preset.json)预设目前仍使用模拟训练。对于真实的大数据集训练，请参考[真实训练功能使用指南](REAL_TRAINING_USAGE_GUIDE.md)。

## 功能特性

1. **自动磁盘空间检查**：当磁盘空间不足时自动暂停训练
2. **检查点保存**：定期保存训练进度，支持从中断处继续
3. **暂停/继续功能**：支持手动暂停和继续训练
4. **模型文件关联**：确保模型文件与项目正确关联

## 训练预设

### full_dataset_training 预设

该预设专为完整数据集训练设计，具有以下特点：

- 使用所有可用数据集进行训练
- 设置100个训练轮数以获得最佳效果
- 批次大小为16，平衡内存使用和训练效率
- 每5个轮次保存一次检查点
- 自动检查磁盘空间，当剩余空间小于5GB时暂停训练

## 使用方法

### 1. 启动完整数据集训练

```bash
# 通过训练管理器启动
tools\train-manager.bat

# 选择选项1（开始训练）
# 选择选项5（full_dataset_training）
```

### 2. 暂停训练

在训练过程中，可以通过以下方式暂停：

1. 在训练控制台按 `Ctrl+C` 发送中断信号
2. 训练脚本会自动保存检查点并退出

### 3. 继续训练

```bash
# 通过训练管理器继续训练
tools\train-manager.bat

# 选择选项4（继续训练）
# 选择相应的预设继续训练
```

### 4. 意外中断后恢复

如果训练因意外中断（如断电），可以使用以下方法恢复：

```bash
# 通过训练管理器恢复训练
tools\train-manager.bat

# 选择选项4（继续训练）
# 系统会自动从最新的检查点继续训练
```

## 磁盘空间管理

### 自动磁盘空间检查

训练脚本会定期检查磁盘空间，当剩余空间小于预设阈值（默认5GB）时自动暂停训练。

### 手动磁盘空间管理

建议定期清理旧的模型文件和检查点：

```bash
# 清理旧的检查点文件（保留最新的3个）
ls training/checkpoints/ | sort -t_ -k2 -n | head -n -3 | xargs -I {} rm training/checkpoints/{}

# 清理旧的模型文件（保留最新的3个）
ls training/models/ | sort -t_ -k2 -n | head -n -3 | xargs -I {} rm training/models/{}
```

## 模型文件与项目关联

### 文件路径管理

所有模型文件和检查点都保存在项目目录中：

- 模型文件：`training/models/`
- 检查点：`training/checkpoints/`
- 配置文件：`training/configs/`

### 关联信息

训练报告中包含详细的模型文件关联信息：

1. 模型文件路径
2. 检查点路径
3. 项目根目录
4. 模型与项目的关联方式

## 最佳实践

### 1. 训练前准备

1. 确保有足够的磁盘空间（建议至少20GB）
2. 检查数据集完整性
3. 备份重要的模型文件

### 2. 训练过程中

1. 定期检查训练进度
2. 监控磁盘空间使用情况
3. 根据需要调整训练参数

### 3. 训练完成后

1. 评估模型性能
2. 清理不必要的检查点文件
3. 备份最终模型文件

## 故障排除

### 磁盘空间不足

如果遇到磁盘空间不足的问题：

1. 清理临时文件和旧的模型文件
2. 将模型文件移动到外部存储设备
3. 调整训练预设中的批次大小以减少内存使用

### 训练中断

如果训练意外中断：

1. 检查最新的检查点文件
2. 使用继续训练功能恢复训练
3. 如果检查点文件损坏，可能需要重新开始训练

### 模型性能问题

如果模型性能不理想：

1. 检查训练数据质量
2. 调整训练参数（学习率、批次大小等）
3. 增加训练轮数