# Game Systems Overview (遊戲系統總覽)

## 簡介 (Introduction)

`game` 模組提供了「安琪拉的世界 (Angela's World)」的完整模擬環境。此環境使用 `pygame` 函式庫建立，並圍繞一個非同步（`async`）的主遊戲循環來運作。其主要目的是為核心 AI 角色「安琪拉 (Angela)」提供一個豐富、可互動的世界，讓她能夠在其中生活，並與玩家進行有意義的互動。

## 核心架構 (Core Architecture)

遊戲的整體架構由以下幾個關鍵部分組成：

### 1. 主遊戲循環 (`main.py`)
- **`Game` 類別**: 作為遊戲的進入點和最高層級的協調器，負責初始化所有子系統、載入資源（圖片、聲音等），並啟動和管理主遊戲循環。
- **非同步循環**: `Game.run()` 方法是一個 `async` 函式，它以固定的幀率（例如 60 FPS）不斷循環，並在每一幀中依序呼叫 `handle_events`（處理輸入）、`update`（更新遊戲狀態）和 `render`（繪製畫面）。

### 2. 遊戲狀態機 (`scenes.py`)
- **`GameStateManager`**: 這是整個遊戲流程的控制核心。`Game` 類別將大部分的邏輯委派給狀態管理器。此管理器實現了一個狀態機模式，根據當前遊戲處於哪個狀態（例如，`MainMenuScene`, `WorldScene`, `DialogueScene`），來執行對應的邏輯。
- **場景 (Scenes)**: 每個場景都是一個獨立的模組，負責處理該場景下的特定輸入、遊戲邏輯和畫面渲染。這種設計讓不同遊戲環節的程式碼能夠被清晰地隔離開來。

## 關鍵子系統 (Key Subsystems)

以下是構成遊戲世界的主要子系統。每個子系統都有明確的職責，並共同合作創造出完整的遊戲體驗。

### 角色系統 (`player.py`, `angela.py`, `npcs.py`)
- **職責**: 管理遊戲世界中所有能動的實體。
- **`Player`**: 玩家所控制的角色。其狀態主要由玩家的直接輸入（如鍵盤）來更新。
- **`Angela`**: 遊戲的核心 AI 實體。她的行為不僅回應玩家的互動，更由其內部的 AI 邏輯（例如，`check_for_proactive_interaction`）所驅動。她是遊戲世界與後端 AI 大腦（如 `DialogueManager`）之間的橋樑。
- **`NPCs`**: 遊戲中其他的非玩家角色，他們可能遵循預設的腳本或簡單的 AI 行為模式。
- **(詳細請見：[角色系統](characters.md))**

### 物品與庫存系統 (`items.py`, `inventory.py`)
- **職責**: 定義遊戲中所有可被收集、使用或交易的物品，並管理每個角色（包括玩家和 NPC）所持有的物品庫存。
- **(詳細請見：[物品與庫存系統](items-and-inventory.md))**

### 世界與場景系統 (`scenes.py`, `tiles.py`)
- **職責**: 定義和管理遊戲世界的結構，包括地圖、不同區域（場景）以及場景之間的轉換。`tiles.py` 可能用於實現基於圖塊的二維地圖。
- **(詳細請見：[世界與場景系統](world-and-scenes.md))**

### UI 系統 (`ui.py`)
- **職責**: 負責在螢幕上繪製所有使用者介面元素，例如對話框、選單、狀態欄（HUD）、按鈕等。它為玩家提供與遊戲系統互動的視覺回饋。
- **(詳細請見：[UI 系統](ui.md))**
